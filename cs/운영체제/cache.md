# 캐시메모리

## 캐시메모리란?
- 캐시메모리는 자주 사용하는 프로그램과 데이터를 저장해두어 속도를 빠르게하는 메모리를 말합니다.
    - 따라서 캐시는 주기억 장치보다 용량이 작다.
    - 캐시 기억장치와 주기억장치 사이에서 정보를 옮기는 것을 **매핑**이라고 한다.
        - 매핑에는 직접 매핑(Direct Mapping), 연관 매핑(Associate Mapping), 집합 연관 매핑(Set Associate Mapping)이 있습니다.
- **속도가 빠른 장치와 느린 장치간의 속도차에 따른 병목 현상을 줄이기 위한 범용 메모리**
    - 이를 위해서는 CPU가 어떤 데이터를 원하는지 예측할 수 있어야한다.
    - 캐시 메모리에 CPU가 원하는 정보가 얼마나 들어있느냐에 따라 캐시의 성능이 좌우되기 때문이다.
- 주기억 장치와 CPU사이에 윙치한다.
- 메모리 계층구조에서 가장 빠른 소자이며, 처리속도가 거의 CPU속도와 비슷할 정도의 속도를 가지고 있다.
- 캐시메모리를 사용하면 주기억장치에 접근하는 횟수가 줄어들어 컴퓨터의 처리속도가 향상된다.

## 캐시의 지역성
- 캐시가 효율적으로 동작하려면 hit rate를 극대화시켜야한다.
- 캐시에 저장할 데이터가 지역성을 가지게 한다. **지역성이란 데이터의 접근이 시간적이나 공간적으로 가깝게 일어나는 것을 의미한**다.
- 지역성의 전제조건으로 프로그램은 모든 코드나 데이터를 균등하게 액세스하지 않는다는 특성을 기본으로 한다.

### 지역성(Locality)의 종류
- **시간적 지역성**
    - 특정 데이터가 한번 접근되었을 경우, 가까운 미래에 또 한번 데이터에 접근할 가능성이 높은 것
    - 메모리 상의 같은 주소에 여러번 읽기, 쓰기를 수행할 경우 일어난다.
        - 상대적으로 작은 크기의 캐시를 사용해도 효율성을 꾀할 수 있다.
- **공간적 지역성**
    - 대부분의 실제 프로그램이 참조된 주소와 인접한 주소의 내용이 다시 참조되는 특성이다.

## Cache line
주 메모리의 내용을 캐시에 저장하기 위해서 주 메모리의 데이터를 읽어와야 한다. 이때, **읽어들이는 최소 단위를 캐시 라인(cache-line)이라고 하며** 이렇게 읽어들인 데이터는 
캐시의 data block을 구성하게 된다. 캐시는 아래와 같이 간략하게 나타낼 수 있다.

<img width="70%" alt="image" src="https://user-images.githubusercontent.com/76734067/216339496-e824adc1-1f48-44a1-81e5-cd486c4128e9.png">

메모리 주소의 일부를 이용하여 만든 태그와 해당 캐시라인의 상태를 나타내는 상태비트, 그리고 데이터 블록으로 구성된다.
### Direct Map
메모리 주소의 일부를 인덱스(위의 태그)로 사용하여 관리하는 방식이다. 테이블이 한개라서 같은 태그는 한개의 캐시 공간만 사용할 수 있습니다. 그래서 캐시메모리에 데이터가 있는지 찾으려면 비교는 한번만 해도 되서 빠르지만 충돌이 그만큼 자주일어나는 단점이 있습니다.

### Full Associative
태그와 관계없이 비어있는 캐시메모리를 탐색해서 집어넣는 방식이다. <br>
데이터가 있는지 찾을때도 순차적으로 탐색해서 가져오는 방식이다. 충돌의 위험은 적지만 비교할때마다 순차탐색의 시간이 발생하므로 오래 걸린다.

### Set Associative
Direct Map과 Full Associative의 장점을 고려해서 만들어진 방식이다. 테이블을 여러개 만들면 같은 태그의 메모리라도 다른 테이블의 태그에 저장하면 되는 원리라서 테이블의 개수에 따라 n-way set associative라고 부른다.<br>
이렇게하면 n번만 탐색해서 Direct Mapped보단 시간이 조금 더 걸리지만, 충돌위험은 줄어들게 된다.

# Question
> **캐시 메모리는 어디에 위치해 있나요?**<br>
> 캐시는 주기억장치와 CPU사이에 위치합니다.

> **L1, L2 캐시에 대해 설명해주세요**<br>
> CPU에는 캐시메모리가 여러개 사용되는데 L1, L2, L3같은 캐시 메모리등이 여기서 속합니다. 여기서 L이라는 키워드가 속도와 크기에 따라 Level로 분류한것입니다. L1캐시는 일반적으로 CPU 칩안에 내장되어 데이터 사용/참조에 가장먼저 사용됩니다. CPU가 가장 빠르게 접근하게 되고 만약 여기서 데이터를 찾지 못하면 L2 캐시메모리로 넘어갑니다. L2 캐시메모리는 L1캐시와 비슷하지만 속도는 L1캐시보다 느린 캐시입니다. 일반 RAM보다는 속도가 빠릅니다.

> **캐시에 올라온 데이터는 어떻게 관리되나요?**<br>
> 캐시에 올라오게 된 데이터는 LRU와 같은 캐시 관리 알고리즘으로 관리됩니다.

> **캐시 메모리의 Mapping 방식에 대해 설명해 주세요.**<br>
> 캐시메모리의 Mapping 방식은 `Direct Map`, `Full Associative`, `Set Associative`세가지 방식이 있습니다.
> - `Direct Map`: 메모리의 주소의 일부를 태그로 사용해서 매핑하는 방법입니다. 테이블이 한개이기 때문에 같은 태그를 간다면 한개의 캐시 공간만 사용할 수 있다는 특징이 있습니다. 그래서 캐시메모리에 데이터가 있는지 찾으려면 비교는 한번만 하면되서 속도는 빠르지만 그만큼 충돌이 자주 일어날 수 있다는 단점이 있습니다.
> - `Full Associative`: 태그와 관계없이 캐시의 빈공간을 탐색해서 넣는 방식입니다. 데이터가 있는지 찾을 때도 순차적으로 탐색해서 가져오기 때문에 충돌의 위험은 적지만 그만큼 순차탐색시간이 발생하게 됩니다.
> - `Set Associative`는 테이블을 여러개 만들어서 Direct Map과 Full Associative의 장점을 취하는 방식입니다. 같은 태그를 가지더라도 다른테이블에 저장해서 충돌이 발생하지 않게 됩니다. 테이블이 n개라면 n번의 탐색을 할 수도 있으므로 n-way set associative라고 부르기도 합니다.

> **캐시의 지역성에 대해 설명해주세요**<br>
> 캐시의 지역성이란 데이터의 접근이 시간적이나 공간적으로 가깝게 일어나는 것을 말합니다. `시간적 지역성`과, `공간적 지역성`으로 나뉩니다.
> - 시간적 지역성: 특정 데이터가 한번 접근되었을때, 미래에 또한번 같은데이터에 접근할 가능성이 높은 것을 의미한다.
> - 공간적 지역성: 대부분의 프로그램에서 참조된 주소와 인접한 주소의 내용이 다시 참조되는 특성을 말합니다.

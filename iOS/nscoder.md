## NSCoder

<img width="737" alt="image" src="https://user-images.githubusercontent.com/76734067/221345627-700396d2-e682-4f0b-80e8-b21e61abd2ce.png">

`UIView`를 상속해서 커스텀하게 뷰를 구성하게 되면 두 종류의 생성자를 확인할 수 있습니다. 일반적으로 상요하는 frame을 파라미터로 받는 생성자와 NSCoder타입의 coder를 파라미터로 받는 생성자가 있습니다. 이 NSCoder를 사용하는 초기화 생성자는 언제 사용하는지 알아봅시다.

먼저 NSCoder의 정의는 다음과 같이 되어있습니다.

**`다른 객체가 아카이빙 하거나 분배할 수 있도록 해주는 추상클래스이다.`** 

여기서 아카이빙(Archiving)은 `객체와 데이터를 디스크에 저장`하는 것을 의미하고, 분배(Distribution)은 `객체와 데이터를 서로 다른 프로세스나 스레드 사이에서 복사`하는 것을 의미합니다. 라고만 문서에 적혀있고 Archiving과 Serialization에 대한 내용이 문서에 있습니다.

## 아카이빙과 직렬화
아카이빙과 직렬화를 계층을 이루고 있는데이터를 **바이트 스트림**으로 만들 수 있는 방법입니다. 바이트 스트림이 되면 파일에 쓰여질 수도 있고, 네트워크를 통해 전송이 될 수도 있습니다. 이 바이트스트림이 디코딩되면 기존 계층이 그대로 생성됩니다. 아카이빙은 객체들이 서로가지고 있는 관계들과 값을 기록해주고, 직렬화는 계층간의 프로퍼티의 값들이 가지는 값들을 리스트업 해두는 것입니다.

어떤 데이터를 바이트 스트림으로 바꾸고자하고, 여기서 데이터들이 가지고 있는 계층관계도 포함하고 싶은것입니다. 

### Object Graph
객체 중심으로 구성되어있는 애플리케이션은 객체들이 복잡하게 얽혀있습니다. 서로 연결되어 있기도 하고 어떤 객체가 다른 객체를 소유하고 있기도 합니다 이렇게 객체들이 복잡하게 얽혀있는 구조를 객체 그래프(Object Graph)라고 합니다.

이런 객체 그래프의 형태를 가지는 애플리케이션을 파일로 저장하고 싶을때 아카이빙과 직렬화를 사용하게 됩니다. Nib이나 plist파일도 객체 그래프가 파일로 저장된 좋은 예시입니다.

### 아카이브
아카이브를 사용해서 복잡한 객체 그래프를 저장할 수 있게 해줍니다. 아카이빙을 통해서 객체 그래프안에 있는 모든 객체의 식별자를 보존하고 객체들간의 관계도 보존하게 됩니다. 아카이빙된 데이터를 언아카이빙 하면 아카이빙 하기 전 객체 그래프를 정확하게 복원합니다.

아카이브를 데이터 모델의 저장수단으로 사용하면 따로 저장을 위한 포맷팅을 해주지 않아도 되서 이점이 있습니다.

이런 아카이빙을 지원하려면 객체가 반드시 NSCoding프로토콜을 채택하고 있어야 합니다.

### 직렬화
직렬화는 값 객체들을 더 간단하게 저장할 수 있는 방법입니다. 딕셔너리, 배열, 문자열, 바이너리 데이터들을 계층관계로 저장할 수 있습니다. 

다시 **`required init?(coder: NSCoder)`** 에 대해서 살펴보면 NSCoder가 있는 것을 보아서 이 메서드에서 어떤 객체를 아카이빙 하거나 언 아카이빙 한다는 의미입니다.

UIView 문서에 따르면 스토리 보드나 nib파일을 통해 뷰를 로드하면서 커스텀하게 초기화를 해주고 싶다면 이 메서드를 사용하라고 합니다.

nib은 인터페이스 빌더 문서이고, 이 문서가 수정되고 파일이 저장될 때마다 객체그래프가 생성되어서 저장됩니다. 그리고 그 파일을 로드하면 객체 그래프가 언아카이빙 되는 것입니다.

정리하면 스토리보드나 xib는 객체 그래프가 아카이빙된 파일이고, 이파일을 로드해주어야 뷰를 보여줄수 있습니다. 그리고 이때 불리는 생성자가 **`required init?(coder: NSCoder)`** 였던 것입니다.


## 결론
스토리보드나 xib파일은 객체그래프가 아카이빙된 파일입니다. 이 파일을 로드해주어야 뷰를 보여줄 수 있고 그때 불리는 생성자가 required init?(coder: NSCoder) 입니다. 

객체들이 복잡하게 얽혀있는 구조를 객체 그래프라고 하고 이를 파일로 저장하기 위해서 아카이빙과 직렬화를 수행하게 됩니다. NSCoder를 통해서 파일로 저장된 스토리보드나 xib를 언아카이빙을 통해 읽을 수 있게 됩니다.
